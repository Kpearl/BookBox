<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="UserMapper">
	
	<resultMap id="userSelectMap" type="user">
		<result property="email" 					column="email" 					jdbcType="VARCHAR"/>
		<result property="nickname"			column="nickname" 			jdbcType="VARCHAR" />
		<result property="password" 			column="password" 			jdbcType="VARCHAR" />
		<result property="gender" 				column="gender" 					jdbcType="VARCHAR" />
		<result property="birth" 						column="birth" 						jdbcType="VARCHAR" />
		<result property="role" 						column="role" 						jdbcType="VARCHAR" />
		<result property="outerAccount" 	column="outer_account" 		jdbcType="INTEGER" />		
	</resultMap>
	
	
	<!-- SQL : INSERT -->
	<insert 	id="addUser"		parameterType="user" >
	 	INSERT
		INTO user( email , nickname , password , gender , birth,  outer_account, active) 
		VALUES	 (	#{email} , #{nickname} , #{password} , #{gender}  , #{birth}, #{outerAccount}, #{active})
		<!-- <if test="outerAccount != 0">
		1
		</if>
		<if test="outerAccount == 0">
		0
		</if> -->
		
		
	 </insert>
	 
	 
	 <!-- SQL : SELECT ONE -->
	 <select 	id="getUser"	parameterType="user"	 resultMap="userSelectMap">
		SELECT
		email , password, nickname , gender , birth, role, outer_account, active	
		FROM user 
		WHERE email = #{email} AND active = 1
	 </select>
	 
	 
	 <!-- SQL : UPDATE -->
	 <update	id="updateUser"	parameterType="user" >
	   	UPDATE user
	   	<set>
	   		nickname 	= #{nickname} ,
	   		password = #{password},
			gender		= #{gender},
			birth 			= #{birth} 
	   	</set>
	   	<where>
	   		email = #{email}
	   	</where>
	   	 
	 </update>
	 
	 <!-- SQL : updateActive -->
	 <update	id="updateActive"	parameterType="map" >
	   	UPDATE user
	   	<set>
			active 			= #{active}
	   	</set>
	   	WHERE email = #{email}
	 </update>	 
	 
	 

	<!-- SQL : SELECT ROW Count -->	 
	 <select  id="getTotalCount"  parameterType="search"	 resultType="int">
	  	SELECT COUNT(*)
	  	FROM(	SELECT email , nickname , birth, gender
						FROM user ) countTable						
	 </select>

</mapper>